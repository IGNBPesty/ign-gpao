<div class="card shadow mb-4 border-left-primary h-100 py-2">
  <div class="card-header py-3">
    <h6 class="m-0 font-weight-bold text-primary">Jobs</h6>
  </div>
  <div class="card-body">
    <label>Filtrer par projets :</label>
    <select name="projects" id="project-select">
        <option value="-1">-- Tous les projets --</option>
        <% projects.forEach(function( project ){ %>
          <option value="<%= project.id %>"><%= project.id %> - <%= project.name %></option>
        <% }) %>
    </select>
    <div class="table-responsive">
      <table class="table table-bordered table-striped" id="dataTable" cellspacing="0">
    <thead>
			<tr>
        <th>Id</th>
        <th>Nom</th>
				<th>Status</th>
				<th>Code retour</th>
				<th>Date début</th>
        <th>Heure début</th>
        <th>Durée (s)</th>
        <th>Id projet</th>
        <th>Nom du projet</th>
        <th>Action</th>
			</tr>
		</thead>
        <tfoot>
			<tr>
        <th>Id</th>
        <th>Nom</th>
				<th>Status</th>
				<th>Code retour</th>
				<th>Date début</th>
        <th>Heure début</th>
        <th>Durée (s)</th>
        <th>Id projet</th>
        <th>Nom du projet</th>
        <th>Action</th>
			</tr>
        </tfoot>
        <tbody>
        <% jobs.forEach(function( job ){ %>
            <tr>
                <td> <%= job.job_id %></td>
                <td> <%= job.job_name %></td>
                <td> <%= job.job_status %></td>
                <td> <%= job.job_return_code %></td>
                <td> <%= job.date %></td>
                <td> <%= job.hms %></td>
                <td> <%= job.duree %></td>
                <td> <%= job.job_id_project %></td>
                <td> <%= job.project_name %></td>
                <td>
                    <button type="button" onclick="location.href='/job/<%= job.job_id %>'" data-toggle="tooltip" title="Affiche une vue détaillée sur le job <%= job.job_id %>" class="btn btn-circle btn-success">
                        <i class="fas fa-search fa-1x" aria-hidden="true"></i>
                    </button>
                    <%if (job.status == 'failed') { %>
                      <button type="button" onclick='reinitJobs([<%= job.job_id %>])' data-toggle="tooltip" title="Réinitialise le job <%= job.job_id %>" class="btn btn-circle btn-warning">
                        <i class="fas fa-sync-alt fa-1x" aria-hidden="true"></i>
                      </button>
                    <%}%>
                </td>
            </tr>
        <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<script>
  $(document).ready(function() {
    var i = jQuery('<i></i>');
    i.addClass('fas fa-sync-alt fa-1x')

    var button = jQuery('<button></button>');
    button.addClass('btn btn-warning');
    button.attr('type', 'button')
          .attr('data-toggle', "tooltip")
          .attr('title', 'Réinitialise tous les jobs en échecs')
          .attr('onclick', 'reinitAllJobs()')
          .append(i)
          .append(' Réinitialiser les jobs en échecs');
    $("div.toolbar_tab").append(button);


    var table = $('#dataTable').DataTable();
     
    $('#project-select').change( function() {
        table.draw();
    } );

  } );

  $.fn.dataTable.ext.search.push(
    function( settings, data, dataIndex ) {
        var project_id = $('#project-select').val()
        if(project_id == -1){
          return true;
        }else if(data[7]==project_id){
          return true
        }else{
          return false
        }
    }
);
</script>